; generated by Component: ARM Compiler 5.04 update 1 (build 49) Tool: ArmCC [5040049]
; commandline ArmCC [--list --split_sections --debug -c --asm --interleave -o.\stm3210e-eval\main.o --asm_dir=.\STM3210E-EVAL\ --list_dir=.\STM3210E-EVAL\ --depend=.\stm3210e-eval\main.d --cpu=Cortex-M3 --apcs=interwork -O0 -I..\inc -I..\..\..\Libraries\CMSIS\Device\ST\STM32F10x\Include -I..\..\..\Libraries\STM32_USB-FS-Device_Driver\inc -I..\..\..\Libraries\STM32F10x_StdPeriph_Driver\inc -I..\..\..\Utilities\STM32_EVAL -I..\..\..\Utilities\STM32_EVAL\Common -I..\..\..\Utilities\STM32_EVAL\STM3210E_EVAL -IC:\Keil_v5\ARM\RV31\INC -IC:\Keil_v5\ARM\PACK\ARM\CMSIS\3.20.4\CMSIS\Include -IC:\Keil_v5\ARM\Inc\ST\STM32F10x -D__MICROLIB -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD -DUSE_STM3210E_EVAL --omf_browse=.\stm3210e-eval\main.crf ..\src\main.c]
                          THUMB

                          AREA ||i.main||, CODE, READONLY, ALIGN=2

                  main PROC
;;;54     *******************************************************************************/
;;;55     int main(void)
000000  f6ad0d28          SUB      sp,sp,#0x828
;;;56     {
;;;57     	unsigned int 	UpdateFileLen=0;
000004  2400              MOVS     r4,#0
;;;58     	unsigned char filebuf[MAX_LEN];
;;;59     	
;;;60      	unsigned char BootFlag = 0;
000006  2000              MOVS     r0,#0
000008  9009              STR      r0,[sp,#0x24]
;;;61     	unsigned char BootLoader_Key[] = 
00000a  a375              ADR      r3,|L1.480|
00000c  e9d31200          LDRD     r1,r2,[r3,#0]
000010  e9d30302          LDRD     r0,r3,[r3,#8]
000014  e9cd0307          STRD     r0,r3,[sp,#0x1c]
000018  e9cd1205          STRD     r1,r2,[sp,#0x14]
;;;62     	{
;;;63     		0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66
;;;64     		//0x00, 0x11, 0x22, 0x33, 0x44, 0x55, 0x66, 0x77, 0x88, 0x99, 0xaa, 0xbb, 0xcc, 0xdd, 0xee, 0xff
;;;65     	};
;;;66     
;;;67     	Set_System();
00001c  f7fffffe          BL       Set_System
;;;68     	Set_USBClock();
000020  f7fffffe          BL       Set_USBClock
;;;69     		
;;;70     
;;;71     	FLASH_If_Init();
000024  f7fffffe          BL       FLASH_If_Init
;;;72     
;;;73      	/* Check if the Key push-button on STM3210x-EVAL Board is pressed */
;;;74     	BOOT_NVMEM_Read(BOOT_FLAG_ADDR, &BootFlag, BOOT_FLAG_LEN);
000028  2201              MOVS     r2,#1
00002a  a909              ADD      r1,sp,#0x24
00002c  4870              LDR      r0,|L1.496|
00002e  f7fffffe          BL       BOOT_NVMEM_Read
;;;75     #if 1
;;;76     	if(BootFlag == 0xAA)
000032  f89d0024          LDRB     r0,[sp,#0x24]
000036  28aa              CMP      r0,#0xaa
000038  d10f              BNE      |L1.90|
;;;77     	{
;;;78     			// Jump to user application
;;;79     			JumpAddress = *(__IO uint32_t*) (APP_BASE_ADDR + 4);
00003a  486e              LDR      r0,|L1.500|
00003c  6840              LDR      r0,[r0,#4]
00003e  496e              LDR      r1,|L1.504|
000040  6008              STR      r0,[r1,#0]  ; JumpAddress
;;;80     			Jump_To_Application = (pFunction) JumpAddress;
000042  4608              MOV      r0,r1
000044  6800              LDR      r0,[r0,#0]  ; JumpAddress
000046  496d              LDR      r1,|L1.508|
000048  6008              STR      r0,[r1,#0]  ; Jump_To_Application
;;;81     			// Initialize user application's Stack Pointer
;;;82     			__set_MSP(*(__IO uint32_t*) APP_BASE_ADDR);
00004a  496a              LDR      r1,|L1.500|
00004c  6808              LDR      r0,[r1,#0]
00004e  f3808808          MSR      MSP,r0
000052  bf00              NOP      
;;;83     			Jump_To_Application();
000054  4869              LDR      r0,|L1.508|
000056  6800              LDR      r0,[r0,#0]  ; Jump_To_Application
000058  4780              BLX      r0
                  |L1.90|
;;;84     	}
;;;85     	//else
;;;86     	//{
;;;87     	//	BOOT_NVMEM_Write(BOOT_KEY_ADDR, BootLoader_Key, BOOT_KEY_LEN);
;;;88     	//}
;;;89     
;;;90     #endif
;;;91     	
;;;92       Delay_Init(72);
00005a  2048              MOVS     r0,#0x48
00005c  f7fffffe          BL       Delay_Init
;;;93       Led_Config();
000060  f7fffffe          BL       Led_Config
;;;94       Display_Init();
000064  f7fffffe          BL       Display_Init
;;;95     //  Delay_ms(500);
;;;96     
;;;97       Led_Config();
000068  f7fffffe          BL       Led_Config
;;;98     
;;;99       MID_DISP_ShowCharStr(0, 0, "BootVer", strlen("BootVer"));
00006c  a064              ADR      r0,|L1.512|
00006e  f7fffffe          BL       strlen
000072  4605              MOV      r5,r0
000074  462b              MOV      r3,r5
000076  a262              ADR      r2,|L1.512|
000078  2100              MOVS     r1,#0
00007a  4608              MOV      r0,r1
00007c  f7fffffe          BL       MID_DISP_ShowCharStr
;;;100      MID_DISP_ShowCharStr(2, 0, BOOT_VERSION, strlen(BOOT_VERSION));
000080  a061              ADR      r0,|L1.520|
000082  f7fffffe          BL       strlen
000086  4605              MOV      r5,r0
000088  462b              MOV      r3,r5
00008a  a25f              ADR      r2,|L1.520|
00008c  2100              MOVS     r1,#0
00008e  2002              MOVS     r0,#2
000090  f7fffffe          BL       MID_DISP_ShowCharStr
;;;101      
;;;102      SPI_Flash_Config();
000094  f7fffffe          BL       SPI_Flash_Config
;;;103      
;;;104      Format_APDU();
000098  f7fffffe          BL       Format_APDU
;;;105    	
;;;106      USB_Interrupts_Config();
00009c  f7fffffe          BL       USB_Interrupts_Config
;;;107      USB_Init();
0000a0  f7fffffe          BL       USB_Init
;;;108    
;;;109    	if(BootFlag==0x55)
0000a4  f89d0024          LDRB     r0,[sp,#0x24]
0000a8  2855              CMP      r0,#0x55
0000aa  d17d              BNE      |L1.424|
;;;110    	{	
;;;111    		unsigned int totallen,offset,len,addr;
;;;112    		unsigned char percent,tmp;
;;;113    		unsigned char filelen[4];
;;;114    		MID_DISP_ShowCharStr(0, 0, "UPDATING", strlen("UPDATING"));
0000ac  a059              ADR      r0,|L1.532|
0000ae  f7fffffe          BL       strlen
0000b2  4680              MOV      r8,r0
0000b4  4643              MOV      r3,r8
0000b6  a257              ADR      r2,|L1.532|
0000b8  2100              MOVS     r1,#0
0000ba  4608              MOV      r0,r1
0000bc  f7fffffe          BL       MID_DISP_ShowCharStr
;;;115    		MID_DISP_ShowCharStr(4,24,"%",1);
0000c0  2301              MOVS     r3,#1
0000c2  a257              ADR      r2,|L1.544|
0000c4  2118              MOVS     r1,#0x18
0000c6  2004              MOVS     r0,#4
0000c8  f7fffffe          BL       MID_DISP_ShowCharStr
;;;116    		BOOT_NVMEM_Read(BOOTLOADER_LEN_OF_FILE_ADDR, filelen, BOOTLOADER_LEN_OF_FILE_LEN);
0000cc  2204              MOVS     r2,#4
0000ce  a902              ADD      r1,sp,#8
0000d0  4847              LDR      r0,|L1.496|
0000d2  1c40              ADDS     r0,r0,#1
0000d4  f7fffffe          BL       BOOT_NVMEM_Read
;;;117    		UpdateFileLen=(filelen[0]<<24)+(filelen[1]<<16)+(filelen[2]<<8)+filelen[3];
0000d8  f89d0008          LDRB     r0,[sp,#8]
0000dc  0600              LSLS     r0,r0,#24
0000de  f89d1009          LDRB     r1,[sp,#9]
0000e2  eb004001          ADD      r0,r0,r1,LSL #16
0000e6  f89d100a          LDRB     r1,[sp,#0xa]
0000ea  eb002001          ADD      r0,r0,r1,LSL #8
0000ee  f89d100b          LDRB     r1,[sp,#0xb]
0000f2  1844              ADDS     r4,r0,r1
;;;118    		if(UpdateFileLen>FILE_MAX_LEN)
0000f4  f5b43f50          CMP      r4,#0x34000
0000f8  d86c              BHI      |L1.468|
;;;119    		{
;;;120    			
;;;121    		}
;;;122    		else
;;;123    		{
;;;124    			offset=0;
0000fa  2500              MOVS     r5,#0
;;;125    			len=0;
0000fc  2000              MOVS     r0,#0
0000fe  9004              STR      r0,[sp,#0x10]
;;;126    			totallen=UpdateFileLen;
000100  4627              MOV      r7,r4
;;;127    #if 1
;;;128    			while(UpdateFileLen)
000102  e054              B        |L1.430|
                  |L1.260|
;;;129    			{
;;;130    				len=MAX_LEN<UpdateFileLen?MAX_LEN:UpdateFileLen;
000104  f5b46f00          CMP      r4,#0x800
000108  d902              BLS      |L1.272|
00010a  f44f6000          MOV      r0,#0x800
00010e  e000              B        |L1.274|
                  |L1.272|
000110  4620              MOV      r0,r4
                  |L1.274|
000112  9004              STR      r0,[sp,#0x10]
;;;131    				MSD_ReadBuffer(filebuf,SPI_FLASH_FIRMWARE_ADDR+offset,len);
000114  f5051180          ADD      r1,r5,#0x100000
000118  a80a              ADD      r0,sp,#0x28
00011a  9a04              LDR      r2,[sp,#0x10]
00011c  f7fffffe          BL       MSD_ReadBuffer
;;;132    				DES3_App((unsigned char *)BOOT_KEY_ADDR, 1, NULL, filebuf, &len, filebuf);
000120  a80a              ADD      r0,sp,#0x28
000122  a904              ADD      r1,sp,#0x10
000124  ab0a              ADD      r3,sp,#0x28
000126  2200              MOVS     r2,#0
000128  e9cd1000          STRD     r1,r0,[sp,#0]
00012c  2101              MOVS     r1,#1
00012e  4830              LDR      r0,|L1.496|
000130  3810              SUBS     r0,r0,#0x10
000132  f7fffffe          BL       DES3_App
;;;133    				BOOT_NVMEM_Write(APP_BASE_ADDR+offset,filebuf,len);
000136  492f              LDR      r1,|L1.500|
000138  1868              ADDS     r0,r5,r1
00013a  a90a              ADD      r1,sp,#0x28
00013c  9a04              LDR      r2,[sp,#0x10]
00013e  f7fffffe          BL       BOOT_NVMEM_Write
;;;134    				UpdateFileLen-=len;
000142  9804              LDR      r0,[sp,#0x10]
000144  1a24              SUBS     r4,r4,r0
;;;135    				offset+=len;
000146  9804              LDR      r0,[sp,#0x10]
000148  4405              ADD      r5,r5,r0
;;;136    				percent=(offset*100)/totallen;
00014a  2064              MOVS     r0,#0x64
00014c  4368              MULS     r0,r5,r0
00014e  fbb0f0f7          UDIV     r0,r0,r7
000152  b2c6              UXTB     r6,r0
;;;137    				tmp=percent/100+0x30;
000154  2064              MOVS     r0,#0x64
000156  fb96f0f0          SDIV     r0,r6,r0
00015a  3030              ADDS     r0,r0,#0x30
00015c  b2c0              UXTB     r0,r0
00015e  9003              STR      r0,[sp,#0xc]
;;;138    				MID_DISP_ShowCharStr(4,0,&tmp,1);
000160  2301              MOVS     r3,#1
000162  aa03              ADD      r2,sp,#0xc
000164  2100              MOVS     r1,#0
000166  2004              MOVS     r0,#4
000168  f7fffffe          BL       MID_DISP_ShowCharStr
;;;139    				tmp=percent%100/10+0x30;
00016c  2064              MOVS     r0,#0x64
00016e  fb96f1f0          SDIV     r1,r6,r0
000172  fb006011          MLS      r0,r0,r1,r6
000176  210a              MOVS     r1,#0xa
000178  fb90f0f1          SDIV     r0,r0,r1
00017c  3030              ADDS     r0,r0,#0x30
00017e  b2c0              UXTB     r0,r0
000180  9003              STR      r0,[sp,#0xc]
;;;140    				MID_DISP_ShowCharStr(4,8,&tmp,1);
000182  2301              MOVS     r3,#1
000184  aa03              ADD      r2,sp,#0xc
000186  2108              MOVS     r1,#8
000188  2004              MOVS     r0,#4
00018a  f7fffffe          BL       MID_DISP_ShowCharStr
;;;141    				tmp=percent%10+0x30;
00018e  200a              MOVS     r0,#0xa
000190  fb96f1f0          SDIV     r1,r6,r0
000194  fb006011          MLS      r0,r0,r1,r6
000198  3030              ADDS     r0,r0,#0x30
00019a  b2c0              UXTB     r0,r0
00019c  9003              STR      r0,[sp,#0xc]
;;;142    				MID_DISP_ShowCharStr(4,16,&tmp,1);
00019e  2301              MOVS     r3,#1
0001a0  aa03              ADD      r2,sp,#0xc
0001a2  2110              MOVS     r1,#0x10
0001a4  2004              MOVS     r0,#4
0001a6  e000              B        |L1.426|
                  |L1.424|
0001a8  e015              B        |L1.470|
                  |L1.426|
0001aa  f7fffffe          BL       MID_DISP_ShowCharStr
                  |L1.430|
0001ae  2c00              CMP      r4,#0                 ;128
0001b0  d1a8              BNE      |L1.260|
;;;143    			}
;;;144    			BootFlag=0xaa;
0001b2  20aa              MOVS     r0,#0xaa
0001b4  9009              STR      r0,[sp,#0x24]
;;;145    			BOOT_NVMEM_Write(BOOT_FLAG_ADDR, &BootFlag, BOOT_FLAG_LEN);
0001b6  2201              MOVS     r2,#1
0001b8  a909              ADD      r1,sp,#0x24
0001ba  480d              LDR      r0,|L1.496|
0001bc  f7fffffe          BL       BOOT_NVMEM_Write
;;;146    			MID_DISP_ShowCharStr(6, 0, "please reboot", strlen("please reboot"));
0001c0  a018              ADR      r0,|L1.548|
0001c2  f7fffffe          BL       strlen
0001c6  4680              MOV      r8,r0
0001c8  4643              MOV      r3,r8
0001ca  a216              ADR      r2,|L1.548|
0001cc  2100              MOVS     r1,#0
0001ce  2006              MOVS     r0,#6
0001d0  f7fffffe          BL       MID_DISP_ShowCharStr
                  |L1.468|
;;;147    #endif
;;;148    		}
;;;149    
;;;150    	}
0001d4  bf00              NOP      
                  |L1.470|
;;;151    	
;;;152      while (1)
0001d6  e001              B        |L1.476|
                  |L1.472|
;;;153      {
;;;154    	PWR_Check();
0001d8  f7fffffe          BL       PWR_Check
                  |L1.476|
0001dc  e7fc              B        |L1.472|
;;;155      }
;;;156    }
;;;157    
                          ENDP

0001de  0000              DCW      0x0000
                  |L1.480|
0001e0  11223344          DCB      17,"""3DUfw",136,153,0
0001e4  55667788
0001e8  9900    
0001ea  11223344          DCB      17,"""3DUf"
0001ee  5566    
                  |L1.496|
                          DCD      0x08005e10
                  |L1.500|
                          DCD      0x08006000
                  |L1.504|
                          DCD      JumpAddress
                  |L1.508|
                          DCD      Jump_To_Application
                  |L1.512|
000200  426f6f74          DCB      "BootVer",0
000204  56657200
                  |L1.520|
000208  312e352e          DCB      "1.5.7.14",0
00020c  372e3134
000210  00      
000211  00                DCB      0
000212  00                DCB      0
000213  00                DCB      0
                  |L1.532|
000214  55504441          DCB      "UPDATING",0
000218  54494e47
00021c  00      
00021d  00                DCB      0
00021e  00                DCB      0
00021f  00                DCB      0
                  |L1.544|
000220  2500              DCB      "%",0
000222  00                DCB      0
000223  00                DCB      0
                  |L1.548|
000224  706c6561          DCB      "please reboot",0
000228  73652072
00022c  65626f6f
000230  7400    
000232  00                DCB      0
000233  00                DCB      0

                          AREA ||.data||, DATA, ALIGN=2

                  JumpAddress
                          DCD      0x00000000
                  Jump_To_Application
                          DCD      0x00000000

;*** Start embedded assembler ***

#line 1 "..\\src\\main.c"
	AREA ||.rev16_text||, CODE
	THUMB
	EXPORT |__asm___6_main_c_main____REV16|
#line 129 "C:\\Keil_v5\\ARM\\PACK\\ARM\\CMSIS\\3.20.4\\CMSIS\\Include\\core_cmInstr.h"
|__asm___6_main_c_main____REV16| PROC
#line 130

 rev16 r0, r0
 bx lr
	ENDP
	AREA ||.revsh_text||, CODE
	THUMB
	EXPORT |__asm___6_main_c_main____REVSH|
#line 144
|__asm___6_main_c_main____REVSH| PROC
#line 145

 revsh r0, r0
 bx lr
	ENDP

;*** End   embedded assembler ***

                  __ARM_use_no_argv EQU 0
